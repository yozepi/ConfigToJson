name: $(Date:yyyyMMdd)$(Rev:.rr)

trigger:
  branches:
    exclude:
    - "*"

pool:
  vmImage: ubuntu-latest

resources:
  repositories:
  - repository: templates
    type: git
    name: utilities/pipeline-scripts

variables:
- group: 'NuGet-Org'

- name: title
  value: 'ConfigToJson'
  
- name: projectName
  value: yozepi.ConfigToJson/yozepi.ConfigToJson.csproj

- name: baseFolder
  value: '/src'

- name: majorVersion
  value: '0'

- name: minorVersion
  value: '2'

- name: patchVersion
  value: $[counter(format('{0}.{1}', variables['majorVersion'], variables['minorVersion']), 0)]

- name: fullVersion
  value: '$(majorVersion).$(minorVersion).$(patchVersion)-alpha'

stages:
- stage: UnitTest
  displayName: '${{ variables.title }} Build and Test'

  jobs:
  - job:
    displayName: Build and Test
    steps:
    - template: pipeline-templates/build-project.template.yaml@templates
      parameters:
        title: $(title)
        project: $(projectName)
        baseFolder: $(baseFolder)

# - stage: PackAndPublish
#   # dependsOn: UnitTest
#   displayName: '#title# NuGet Pack and Publish'

#   jobs:
#   - job:
#     displayName: Pack and Publish
#     steps:
#     - template: pipeline-templates/nuget-pipeline.template.yaml@templates
#       parameters:
#         title: $(title)
#         project: $(projectName)
#         baseFolder:  $(baseFolder)
#         versionVar: 'fullVersion'
#         apiKey: $(nuget.org.apiKey)
